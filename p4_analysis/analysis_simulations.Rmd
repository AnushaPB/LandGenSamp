---
title: "analysis_tests"
output: html_document
---


```{r}
library("tidyverse")
library("viridis")
library("here")
```

# Pop size
```{r}
df <- read.csv(here("p3_methods", "outputs", "popsize_results.csv"))
df %>% group_by(K) %>% summarize(mean = mean(popsize), min = min(popsize), max = max(popsize))
```

# Mismatch
```{r fig.width=10, fig.height=4}
df <- read.csv(here("p3_methods", "outputs", "mismatch_results.csv"))

df$eff_mismatch <- df$phi * df$mismatch_mean

ggplot(df[df$sampstrat == "full", ], aes(x = eff_mismatch, fill = factor(phi))) +
  geom_boxplot()

df %>% filter(sampstrat == "full") %>% group_by(phi, K, m, r, H) %>% summarise(mean(abs(mismatch_mean)))
df %>% filter(sampstrat == "full") %>% group_by(phi) %>% summarise(mean(abs(mismatch_mean)))
df %>% filter(sampstrat == "full") %>% group_by(H) %>% summarise(mean(abs(mismatch_mean)))

df_long <-
  df %>%
  filter(sampstrat == "full") %>%
  pivot_longer(c(phi, K, m, H, r)) %>%
  group_by(name) %>%
  mutate(value = case_when(
      value == min(value) ~ "low",
      value == max(value) ~ "high",
      TRUE ~ "NA")) %>%
  mutate(level = factor(value))

ggplot(df_long, aes(y = abs(mismatch_mean), fill = level)) +
  geom_boxplot() +
  facet_wrap(~name, nrow = 1) +
  theme(panel.background = element_rect(fill = NA, color = "gray"),
        strip.background = element_rect(color = "gray"),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank()) +
  ylab("|mean mismatch|")
  
```


